# Story 1.2: Style Selection UI

## Status
Draft

## Story
**As a** user,
**I want** to select my style preferences (angle and professional/casual) for my headshot generation,
**so that** I can customize the AI output to match my desired appearance and style.

## Scope Clarifications (vs. Previous Stories)

**âœ… INHERITED from 1.0 (not re-doing here):**
- âœ… INHERITED: Xcode project configuration and Clean Architecture (Story 1.0)
- âœ… INHERITED: App branding, Info.plist, Git repository setup (Story 1.0)
- âœ… INHERITED: SwiftUI app structure and ContentView navigation (Story 1.0)

**âœ… INHERITED from 1.1 (not re-doing here):**
- âœ… INHERITED: Camera/gallery integration and image capture (Story 1.1)
- âœ… INHERITED: Image processing pipeline and resizing (Story 1.1)
- âœ… INHERITED: Permission handling (camera/photo library) (Story 1.1)
- âœ… INHERITED: AppState.selectedInputImage management (Story 1.1)
- âœ… INHERITED: Navigation infrastructure Titleâ†’Captureâ†’Previewâ†’Style (Story 1.1)
- âœ… INHERITED: ImagePreviewView with zoom and accept/retake (Story 1.1)

**âœ… OWNED by 1.2 (delta work):**
- NEW: Style selection UI with angle slider (-1 to 1 range)
- NEW: Professional/Casual toggle switch
- NEW: Style preview interface
- NEW: AppState integration for style parameters
- NEW: Navigation from style selection to generation (Story 1.3 placeholder)

## Swift 6 Architecture Compliance

**ðŸš¨ MANDATORY READING**: `docs/architecture/swift6-concurrency-architecture.md`

**Required Patterns:**
- @MainActor isolation for all UI components (StyleSelectionView, style interactors)
- @preconcurrency import for any legacy APIs if needed
- Task isolation for async operations
- Sendable conformance for style parameter types
- Logger caching to avoid @MainActor capture in background closures

## Acceptance Criteria

1. **Angle Slider**: Given I am on style selection screen, when I interact with the angle slider, then I can select a value between -1.0 and 1.0 with smooth continuous adjustment.

2. **Professional/Casual Toggle**: Given I am on style selection screen, when I tap the professional/casual toggle, then it switches between the two states with clear visual feedback.

3. **Style Preview**: Given I have selected angle and style parameters, when I view the preview area, then I see a visual representation of my selected style preferences.

4. **Parameter Persistence**: Given I have adjusted style parameters, when I navigate away and return, then my selections are preserved in AppState.

5. **Generate Navigation**: Given I have confirmed my style selections, when I tap "Generate", then the app navigates to generation screen (placeholder for Story 1.3).

6. **Back Navigation**: Given I am on style selection screen, when I tap back, then I return to the image preview screen with my image still selected.

7. **Performance**: Given any style parameter adjustment, when I interact with controls, then the UI responds within 100ms with smooth animations.

8. **Accessibility**: Given style selection controls, when using VoiceOver, then all controls are properly labeled and announce their current values.

## Tasks / Subtasks

- [ ] **Style Data Models** (AC: 1, 2, 4)
  - [ ] Create StyleParameters struct with Sendable conformance
  - [ ] Add angle: Double (-1.0 to 1.0) property
  - [ ] Add styleType: StyleType enum (professional, casual)
  - [ ] Update AppState with @Published var selectedStyle: StyleParameters?

- [ ] **StyleSelectionView Implementation** (AC: 1, 2, 3, 6, 7, 8)
  - [ ] Convert existing StyleSelectionView from "Preview Image" to style selection
  - [ ] Implement @MainActor isolation for Swift 6 compliance
  - [ ] Add angle slider with -1.0 to 1.0 range using Slider(value:in:)
  - [ ] Add professional/casual toggle using Toggle with .switch style
  - [ ] Style preview area showing current selections
  - [ ] Back navigation to ImagePreviewView
  - [ ] Performance-optimized UI updates (<100ms response)

- [ ] **Style Preview System** (AC: 3, 7)
  - [ ] Visual preview component showing angle and style selections
  - [ ] Real-time updates as user adjusts parameters
  - [ ] Smooth animations for parameter changes
  - [ ] Accessibility labels for preview content

- [ ] **Navigation Integration** (AC: 5, 6)
  - [ ] "Generate" button navigation to placeholder generation screen
  - [ ] Maintain AppState.selectedInputImage throughout flow
  - [ ] Update AppState.selectedStyle when parameters change
  - [ ] Back button preserves previous screen state

- [ ] **Swift 6 Compliance** (Required for all components)
  - [ ] @MainActor isolation for StyleSelectionView
  - [ ] Sendable conformance for StyleParameters
  - [ ] Proper async/await patterns if needed
  - [ ] Logger caching for any background operations

- [ ] **Performance Optimization** (AC: 7)
  - [ ] Debounced parameter updates to prevent excessive state changes
  - [ ] Optimized slider performance with continuous binding
  - [ ] Smooth toggle animations
  - [ ] Memory-efficient preview rendering

- [ ] **Testing** (AC: All)
  - [ ] Unit tests for StyleParameters model
  - [ ] AppState style parameter integration tests
  - [ ] UI tests for slider and toggle interactions
  - [ ] Navigation flow tests
  - [ ] Accessibility tests for VoiceOver support

## Dev Notes

### Previous Story Insights
From Story 1.1 implementation:
- StyleSelectionView currently shows "Preview Image" layout - needs complete conversion
- AppState pattern with @MainActor isolation is established and working
- Navigation flow Titleâ†’Captureâ†’Previewâ†’Style is established and working
- Swift 6 architecture compliance patterns are established and must be followed

### Swift 6 Architecture Requirements
**MANDATORY COMPLIANCE**: [Source: docs/architecture/swift6-concurrency-architecture.md]
- All UI classes must use @MainActor isolation
- StyleParameters must conform to Sendable for cross-boundary passing
- Any async operations must follow Task isolation patterns
- Logger instances must be cached to avoid @MainActor capture issues

### Style Parameter Data Model
Based on PRD requirements [Source: docs/prd/8-development-roadmap.md]:
```swift
struct StyleParameters: Sendable {
    let angle: Double        // Range: -1.0 to 1.0
    let styleType: StyleType // professional or casual
}

enum StyleType: String, CaseIterable, Sendable {
    case professional = "Professional"
    case casual = "Casual"
}
```

### SwiftUI Control Implementation
Based on Context7 research [Source: /zhangyu1818/swiftui.md]:

**Angle Slider Implementation:**
```swift
Slider(value: $angle, in: -1.0...1.0)
    .accessibility(label: Text("Photo angle adjustment"))
    .accessibility(value: Text("\(Int(angle * 100)) percent"))
```

**Professional/Casual Toggle:**
```swift
Toggle("Style Type", isOn: $isProfessional)
    .toggleStyle(.switch)
    .accessibility(label: Text("Professional or casual style"))
```

### AppState Integration
Update existing AppState class [Source: existing AppState pattern from Story 1.1]:
```swift
@MainActor
class AppState: ObservableObject {
    // Existing properties from Stories 1.0-1.1
    @Published var selectedInputImage: UIImage? = nil

    // New properties for Story 1.2
    @Published var selectedStyle: StyleParameters? = nil

    func setSelectedStyle(_ style: StyleParameters) {
        logger.info("ðŸŽ¨ Setting selected style: angle=\(style.angle), type=\(style.styleType)")
        selectedStyle = style
    }
}
```

### UI Design Requirements
Based on PRD UI specifications [Source: docs/prd/7-user-interface-design.md]:
- Color Palette: Modern, professional blues and grays
- Typography: SF Pro (iOS system font)
- Spacing: Apple HIG compliant
- Animations: Subtle, purposeful transitions

### Navigation Flow Design
Story 1.2 navigation pattern:
1. **ImagePreviewView** â†’ "Use This Photo" â†’ **StyleSelectionView** (modified)
2. **StyleSelectionView** â†’ "Generate" â†’ **GenerationView** (placeholder for Story 1.3)
3. **StyleSelectionView** â†’ "Back" â†’ **ImagePreviewView**

### File Structure and Locations
Based on Clean Architecture from Story 1.0:
```
Facemake/
â”œâ”€â”€ Views/
â”‚   â””â”€â”€ StyleSelectionView.swift (modify existing)
â”œâ”€â”€ Models/
â”‚   â””â”€â”€ StyleParameters.swift (new)
â””â”€â”€ Resources/
    â””â”€â”€ (existing assets)
```

### Performance Requirements
Based on PRD performance requirements [Source: docs/prd/5-detailed-requirements.md]:
- App response time: < 100ms for UI interactions
- Smooth slider performance with continuous updates
- Memory-efficient preview rendering
- No performance regressions from Story 1.1

### Accessibility Requirements
Following Apple HIG accessibility standards:
- VoiceOver support for all interactive elements
- Clear accessibility labels for slider values
- Semantic role identification for toggle states
- Dynamic Type support for text elements

### Error Handling Strategy
Following coding standards [Source: docs/architecture/13-coding-standards.md]:
- Never expose internal errors to users
- Graceful fallbacks for invalid parameter values
- User-friendly messaging for any constraint violations
- Proper validation of angle range (-1.0 to 1.0)

## Testing

### Testing Strategy
From Story 1.1 established patterns:
- Framework: XCTest for unit/UI testing
- Location: FacemakeTests/ and FacemakeUITests/ folders
- Naming: Test classes end with "Tests", methods start with "test"

### Required Tests for Story 1.2
1. **StyleParametersTests**: Test model validation and Sendable compliance
2. **StyleSelectionViewTests**: Test UI interactions and parameter binding
3. **AppStateStyleTests**: Test style parameter state management
4. **StyleNavigationTests**: Test navigation flow with style selection

### Performance Testing
- Slider interaction response time validation (<100ms)
- Memory usage monitoring during parameter changes
- Animation smoothness verification
- AppState update efficiency testing

## Performance Requirements

- **UI Response**: All interactions must complete within 100ms
- **Memory Usage**: Efficient parameter storage and updates
- **Animation Performance**: Smooth 60fps transitions
- **State Management**: Optimized AppState updates without excessive re-renders

## No-Go List (Out of Scope for 1.2)

- âŒ Actual AI generation (Story 1.3)
- âŒ Additional style parameters beyond angle and professional/casual
- âŒ Style preview with actual image processing
- âŒ Save/load style presets
- âŒ Advanced style customization options

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-16 | 1.0 | Initial story creation with inheritance validation and Swift 6 compliance | Bob (Scrum Master) |